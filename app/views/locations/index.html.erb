<p id="notice"><%= notice %></p>

<div class="cards"></div>

<%= javascript_tag do %>

  function success(data) {

    getLocations({
      lat: data.coords.latitude,
      lon: data.coords.longitude
    }, function (locations) {

      var mapCenter = {
        lat: locations.location[0],
        lon: locations.location[1]
      };

      var map = bittersMap(mapCenter);

      locations.locations.forEach(function (location) {
        var container = document.querySelector('.cards');  

        cardify(container, location);

        var markData = {
          lat: location.latitude,
          lon: location.longitude
        }

        map.mark(markData);

      });

    });
  }

  function cardify (container, location) {
    container.innerHTML += `
      <div class="card">
        <div class="card-header">
          ${location.name}
        </div>
        <div class="card-copy">
          <strong>Name: </strong>
          <p>${location.name}</p>
          <strong>Address: </strong>
          <p>${location.street}</p>
        </div>
      </div>`
  }

  function error () {
    console.log('didnt get the data');
  }

  navigator.geolocation.getCurrentPosition(success, error);

<% end %>
